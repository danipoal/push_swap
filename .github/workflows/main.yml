name: Build and Test C Program with Multiple Runs

on: [push, pull_request]

jobs:
  build-and-run:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repo
      uses: actions/checkout@v3

    - name: Build with make
      run: make re

    - name: Run multiple test combinations and check return codes
      run: |
        set -e
        combos=(
          "7 14 21 28 35 42 49 56 63"
          "1 3 5 7 9 11 13 15 17 19"
          "10 20 30 40 50 60 70"
          "2 4 6 8 10 12 14 16 18 20"
          "99 88 77 66 55 44 33 22 11"
          "17 23 29 31 37 41 43 47 53"
          "1001 1002 1003 1004 1005"
          "102 305 607 809 910 1002"
          "11 22 33 44 55 66 77 88 99"
          "901 902 903 904 905 906"
          "123 234 345 456 567 678"
          "31 62 93 124 155 186"
          "3 6 9 12 15 18 21"
          "42 84 126 168 210"
          "75 150 225 300 375"
          "13 26 39 52 65 78"
          "5 25 125 625"
          "1 10 100 1000 10000"
          "333 666 999 1332"
          "77 154 231 308"
          "7 19 34 58 2 81 93 44 13 76 22 67 90 11 26 38 59 99 6 48 72"
          "105 210 315 420 525 630 735 840 945 1050 1155 1260 1365 1470 1575 1680 1785 1890 1995 2100 2205"
          "1 3 7 15 31 63 127 255 511 1023 2047 4095 8191 16383 32767 65535 131071 262143 524287 1048575 2097151"
          "5 10 25 50 75 100 125 150 175 200 225 250 275 300 325 350 375 400 425 450 475"
          "8 16 24 32 40 48 56 64 72 80 88 96 104 112 120 128 136 144 152 160 168 176"
        )

        for args in "${combos[@]}"; do
          echo "$args"
          ./a.out $args
          code=$?
          if [ $code -eq 1 ]; then
            echo "❌ Failure with args: $args"
            exit 1
          elif [ $code -ne 0 ]; then
            echo "⚠️ Unexpected return code $code with args: $args"
            exit 1
          fi
        done
